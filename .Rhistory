playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
nationID=nation_id,
nationDESC,
season_year=ifelse(is.na(season_year),
unique(leagues() %>%
filter(levelID==1) %>%
pull(season_year)),
season_year),
file_date=leagues() %>% pull(file_date) %>% unique()) %>%
mutate(baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25))
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC, levelDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(leagues() %>%
filter(levelID==1) %>%
pull(season_year)),
season_year),
file_date=leagues() %>% pull(file_date) %>% unique()) %>%
mutate(baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25))
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC, levelDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC=nationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(leagues() %>%
filter(levelID==1) %>%
pull(season_year)),
season_year),
file_date=leagues() %>% pull(file_date) %>% unique()) %>%
mutate(baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25))
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC=nationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(leagues() %>%
filter(levelID==1) %>%
pull(season_year)),
season_year),
file_date=leagues() %>% pull(file_date) %>% unique()) %>%
mutate(baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25))
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC=nationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(df_leagues %>%
filter(leagueID==100) %>%
pull(season_year)),
season_year),
file_date=df_leagues %>% pull(file_date) %>% unique()) %>%
mutate(baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25))
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC=nationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(df_leagues %>%
filter(leagueID==100) %>%
pull(season_year)),
season_year),
file_date=df_leagues %>% pull(file_date) %>% unique())
players=function(){
ootpRead("players.csv") %>%
filter(retired==0 & hidden==0) %>%
left_join(as.data.frame(cbind(position=1:13,
posDESC=c("P", "C", "1B", "2B", "3B",
"SS", "LF", "CF", "RF",
"DH", "SP", "RP", "CL"))) %>%
mutate(position=as.numeric(position),
posDESC=factor(posDESC,
levels=c("P", "SP", "CL", "RP", "C",
"1B", "2B", "3B", "SS",
"LF", "CF", "RF", "DF"))),
by="position") %>%
left_join(df_leagues %>%
select(leagueID, leagueDESC, levelID, levelDESC,
season_year, file_date),
by=c("league_id"="leagueID")) %>%
left_join(df_cities %>%
transmute(city_of_birth_id=cityID,
birthCity=cityNAME),
by="city_of_birth_id") %>%
left_join(df_teams %>%
select(teamID, teamDESC, orgID, orgDESC),
by=c("team_id"="teamID")) %>%
left_join(df_nations %>%
transmute(nation_id=nationID,
homeNationDESC=nationDESC),
by="nation_id") %>%
transmute(playerID=player_id,
playerNAME=paste(first_name, last_name),
posID=position,
posDESC,
leagueID=league_id,
leagueDESC,
levelID,
levelDESC,
orgID=organization_id,
orgDESC,
teamID=team_id,
teamDESC,
bats=ifelse(bats==1,
"R",
ifelse(bats==2,
"L",
ifelse(bats==3,
"S",
NA))),
throws=ifelse(throws==1,
"R",
ifelse(throws==2,
"L",
NA)),
date_of_birth=lubridate::ymd(date_of_birth),
baseballAGE=floor(as.numeric(difftime(
lubridate::ymd(paste0(season_year, "06-30")),
date_of_birth))/365.25),
birthCityID=city_of_birth_id,
birthCity,
homeNationID=nation_id,
homeNationDESC,
season_year=ifelse(is.na(season_year),
unique(df_leagues %>%
filter(leagueID==100) %>%
pull(season_year)),
season_year),
file_date=df_leagues %>% pull(file_date) %>% unique())
};
df_players=players();
rm(players);
rm(teams);
rm(orgs)
batting_stats=function(){
ootpRead("players_career_batting_stats.csv") %>%
rename(playerID=player_id,
teamID=team_id,
leagueID=league_id) %>%
inner_join(players() %>%
transmute(playerID,
playerNAME,
posDESC,
bats,
baseballAGE,
season_year),
by="playerID") %>%
left_join(teams() %>%
transmute(teamID,
teamDESC=ifelse(levelID==1,
teamDESC,
paste(orgDESC, levelDESC, sep=" ")),
leagueID,
leagueDESC,
levelID),
by=c("teamID", "leagueID")) %>%
transmute(playerID,
playerNAME,
year,
age=baseballAGE-(season_year-year),
teamID,
teamDESC,
leagueID,
leagueDESC,
levelID,
split_id=ifelse(split_id==1,
"FS",
ifelse(split_id==2,
"vL",
ifelse(split_id==3,
"vR", NA))),
bats,
g,
gs,
pa,
ab,
avg=round(h/ab, 3),
obp=round((h+bb+hp)/(ab+bb+hp+sf), 3),
slg=round((h-(d+t+hr) + 2*d + 3*t + 4*hr)/ab, 3),
ops=obp+slg,
h,
db=d,
tr=t,
hr,
r,
rbi,
k,
bb,
ibb,
hbp=hp,
sf,
sh,
gdp,
sb,
cs,
pitchesPA=round(pitches_seen/pa, 1),
war=round(war, 1))
};
